<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Birthday GPS for Krisztian</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
html,body,#map {
  height:100%;
  margin:0;
  padding:0;
}

/* Distance top-left box */
#distanceBox {
  position: fixed;
  top: 10px;
  left: 10px;
  background: rgba(255,255,255,0.9);
  padding: 8px 14px;
  border-radius: 10px;
  font-family: sans-serif;
  font-size: 16px;
  z-index: 1500;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* Controls container */
#controls {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
}

/* Start button styling */
#startBtn {
  padding: 16px 32px;
  border: none;
  border-radius: 50px;
  background: linear-gradient(135deg, #ff7b00, #ffb347);
  color: white;
  font-size: 18px;
  font-weight: bold;
  font-family: 'Helvetica Neue', sans-serif;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  animation: pulse 1.5s infinite;
}

#startBtn:active {
  transform: scale(0.95);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  animation: none;
}

@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 123, 0, 0.7); }
  70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(255, 123, 0, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 123, 0, 0); }
}

/* Gift icon */
#giftIcon {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  font-size: 4rem;
  cursor: pointer;
  display: none;
  z-index: 3000;
  animation: bounce 1s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translate(-50%, -50%) scale(1); }
  50% { transform: translate(-50%, -60%) scale(1.2); }
}
</style>
</head>
<body>
<div id="map"></div>
<div id="distanceBox">Distance: -- m</div>
<div id="controls">
  <button id="startBtn">Start</button>
</div>
<div id="giftIcon">üéÅ</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// --- Map Setup ---
const map = L.map('map',{zoomControl:false}).setView([47.5,19],14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

// --- Car Marker ---
const carIcon = L.icon({
    iconUrl: 'https://Dorisz1.github.io/assets/car.png',
    iconSize: [72, 72],
    iconAnchor: [36, 36]
});
let carMarker = null;

// --- Destination ---
const destination = L.latLng(47.50106631785516, 19.032813874256586);

// --- Destination Marker ---
const destinationIcon = L.icon({
    iconUrl: 'https://cdn-icons-png.flaticon.com/512/11529/11529542.png',
    iconSize: [48,48],
    iconAnchor: [24,48],
    popupAnchor: [0,-48]
});
L.marker(destination, {icon: destinationIcon}).addTo(map).bindPopup("Destination");

// --- Audio ---
const audioStart = 'https://Dorisz1.github.io/assets/start.mp3';
const audioArrival = 'https://Dorisz1.github.io/assets/arrival.mp3';
const birthdaySong = 'https://Dorisz1.github.io/assets/birthdaysong.mp3';
const audio1 = 'https://dorisz1.github.io/assets/1.mp3';
const audio2 = 'https://dorisz1.github.io/assets/2.mp3';
const audio3 = 'https://dorisz1.github.io/assets/3.mp3';

function playAudio(url){
    const audio = new Audio(url);
    audio.play();
}

// --- Flags to avoid replay ---
let arrived = false;
let playedAudio1 = false;
let playedAudio2 = false;
let playedAudio3 = false;

// --- Update Car ---
function updateCar(latlng){
    if(!carMarker){
        carMarker = L.marker(latlng,{icon:carIcon}).addTo(map);
        map.setView(latlng,16);
    } else {
        carMarker.setLatLng(latlng);
    }

    map.setView(latlng,16);

    const distance = latlng.distanceTo(destination);
    document.getElementById('distanceBox').innerText =
        "Distance: " + Math.round(distance) + " m";

    // Distance-based audio triggers
    if(!playedAudio1 && distance < 600){
        playedAudio1 = true;
        playAudio(audio1);
    }
    if(!playedAudio2 && distance < 400){
        playedAudio2 = true;
        playAudio(audio2);
    }
    if(!playedAudio3 && distance < 200){
        playedAudio3 = true;
        playAudio(audio3);
    }

    // Arrival audio
    if(!arrived && distance < 60){
        arrived = true;
        playAudio(audioArrival);
    }

    // Gift icon
    if(distance < 30){
        document.getElementById('giftIcon').style.display='block';
    }
}

// --- Start Button ---
document.getElementById('startBtn').onclick = function(){
    playAudio(audioStart);

    if(navigator.geolocation){
        navigator.geolocation.watchPosition(pos=>{
            const latlng = L.latLng(pos.coords.latitude,pos.coords.longitude);
            updateCar(latlng);
        }, err=>alert("GPS error: "+err.message), {enableHighAccuracy:true});
    } else alert("Geolocation not supported");
};

// --- Gift Icon Click ---
document.getElementById('giftIcon').onclick = function(){
    playAudio(birthdaySong);
};
</script>
</body>
</html>
